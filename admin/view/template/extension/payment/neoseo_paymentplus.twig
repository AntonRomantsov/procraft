{{ header }}{{ column_left }}

<div id="content">

  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
          {% if license_error == null  %}
        <button type="submit" name="action" value="save" form="form" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i> {{ button_save }}</button>
        <button type="submit" name="action" value="save_and_close" form="form" data-toggle="tooltip" title="{{ button_save_and_close }}" class="btn btn-default"><i class="fa fa-save"></i> {{ button_save_and_close }}</button>
          {% else %}
              <a href="{{ recheck }}" data-toggle="tooltip" title="{{ button_recheck }}" class="btn btn-primary" /><i class="fa fa-check"></i> {{ button_recheck }}</a>
          {% endif %}
          <a href="{{ close }}" data-toggle="tooltip" title="{{ button_close }}" class="btn btn-default"><i class="fa fa-close"></i> {{ button_close }}</a>
      </div>
      
      <img width="36" height="36" style="float:left" src="view/image/neoseo.png" alt=""/>
      <h1>{{ heading_title_raw }} {{ text_module_version }}</h1>
      
      <ul class="breadcrumb">
          {% for breadcrumb in breadcrumbs %}
              <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
          {% endfor %}
      </ul>
      
    </div>
  </div>
  
    <div class="container-fluid">

        {% if error_warning %}
            <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}

        {% if success is defined and success %}
            <div class="alert alert-success">
                <i class="fa fa-check-circle"></i>
                {{ success }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
    
        <div class="panel panel-default">
            <div class="panel-body">

                <ul class="nav nav-tabs">
                    <li class="active"><a href="#tab-general" data-toggle="tab">{{ tab_general }}</a></li>
                    {% if license_error == null  %}
                        <li><a href="#tab-methods" data-toggle="tab">{{ text_list }}</a></li>
                        <li><a href="#tab-logs" data-toggle="tab">{{ tab_logs }}</a></li>
                    {% endif %}
                    <li><a href="#tab-support" data-toggle="tab">{{ tab_support }}</a></li>
                    <li><a href="#tab-usefull" data-toggle="tab">{{ tab_usefull }}</a></li>
                    <li><a href="#tab-license" data-toggle="tab">{{ tab_license }}</a></li>
                </ul>

                <form action="{{ save }}" method="post" enctype="multipart/form-data" id="form">
                    <div class="tab-content">
                        <div class="tab-pane active" id="tab-general">
                            {% if license_error == null  %}
                                {{ widgets.dropdown('status', {0: text_disabled, 1: text_enabled})  }}
                                {{ widgets.input('sort_order')  }}
                            {% else %}
                                {{ license_error }}
                            {% endif %}
                        </div>

                        <div class="tab-pane" id="tab-methods">
                            <div class="container-fluid">
                                <div class="pull-right">
                                    {% if license_error == null  %}
                                        <a href="{{ add }}" data-toggle="tooltip" title="{{ button_add }}" class="btn btn-primary"><i class="fa fa-plus"></i></a>
                                        <button id="button-copy" type="button" data-toggle="tooltip" title="{{ button_copy }}" class="btn btn-default" ><i class="fa fa-copy"></i></button>
                                        <button id="button-remove" type="button" data-toggle="tooltip" title="{{ button_delete }}" class="btn btn-danger" ><i class="fa fa-trash-o"></i></button>
                                    {% else %}
                                        <a href="{{ recheck }}" data-toggle="tooltip" title="{{ button_recheck }}" class="btn btn-primary" /><i class="fa fa-check"></i> {{ button_recheck }}</a>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="panel-body">
                                <div id="form-payments">
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-hover">
                                            <thead>
                                            <tr>
                                                <td style="width: 1px;" class="text-center"><input type="checkbox" onclick="$('input[name*=\'selected\']').prop('checked', this.checked);" /></td>
                                                <td class="text-left">{{ column_name }}</td>
                                                <td class="text-left">{{ column_status }}</td>
                                                <td class="text-right">{{ column_sort_order }}</td>
                                                <td class="text-right">{{ column_action }}</td>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% if payments %}
                                            {% for payment in payments %}
                                            <tr>
                                                <td class="text-center">
                                                  {% if payment.payment_id in selected %}
                                                    <input type="checkbox" name="selected[]" value="{{ payment.payment_id }}" checked="checked" />                                               {% else %}
                                                    <input type="checkbox" name="selected[]" value="{{ payment.payment_id }}" />
                                                  {% endif %}
                                                </td>
                                                <td class="text-left">{{ payment.name }}</td>
                                                <td class="text-left">{{ statuses[payment.status] }}</td>
                                                <td class="text-left">{{ payment.sort_order }}</td>
                                                <td class="text-right">
                                                    <a href="{{ payment.edit }}" data-toggle="tooltip" title="{{ button_edit }}" class="btn btn-primary"><i class="fa fa-pencil"></i></a>
                                                    <a href="{{ payment.delete }}" data-toggle="tooltip" title="{{ button_delete }}" class="btn btn-danger"><i class="fa fa-trash-o"></i></a>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                            {% else %}
                                            <tr>
                                                <td class="text-center" colspan="5">{{ text_no_results }}</td>
                                            </tr>
                                            {% endif %}
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6 text-left">{{ pagination }}</div>
                                        <div class="col-sm-6 text-right">{{ results }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {% if license_error == null  %}
                            <div class="tab-pane" id="tab-logs">
                                {{ widgets.debug_download_logs('debug', {0: text_disabled, 1: text_enabled}, clear, download, button_clear_log, button_download_log)  }}
                                <textarea style="width: 100%; height: 300px; padding: 5px; border: 1px solid #CCCCCC; background: #FFFFFF; overflow: scroll;">{{ logs }}</textarea>
                            </div>
                        {% endif %}
                        <div class="tab-pane" id="tab-support">
                            {{ mail_support }}
                        </div>
                        <div class="tab-pane" id="tab-license">
                            {{ module_licence }}
                        </div>
                        <div class="tab-pane" id="tab-usefull">
                            {{ widgets.usefullLinks() }}
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    if (window.location.hash.indexOf('#tab') == 0 && $("[href=" + window.location.hash + "]").length) {
        $(".panel-body > .nav-tabs li").removeClass("active");
        $("[href=" + window.location.hash + "]").parents('li').addClass("active");
        $(".panel-body:first .tab-content:first .tab-pane:first").removeClass("active");
        $(window.location.hash).addClass("active");
    }
    $(".nav-tabs li a").click(function () {
        var url = $(this).prop('href');
        window.location.hash = url.substring(url.indexOf('#'));
    });
    // Специальный фикс системной функции, поскольку даниель понятия не имеет о том что в url может быть еще и hash
    // и по итогу этот hash становится частью token
    function getURLVar(key) {
        var value = [];

        var url = String(document.location);
        if( url.indexOf('#') != -1 ) {
            url = url.substring(0, url.indexOf('#'));
        }
        var query = url.split('?');

        if (query[1]) {
            var part = query[1].split('&');

            for (i = 0; i < part.length; i++) {
                var data = part[i].split('=');

                if (data[0] && data[1]) {
                    value[data[0]] = data[1];
                }
            }

            if (value[key]) {
                return value[key];
            } else {
                return '';
            }
        }
    }
    $(document).ready(function (e) {
        $('#button-remove').on('click', function () {
            if (confirm('{{ text_confirm }}')) {
                var hiddenForm = $('<form  method="post" enctype="multipart/form-data" id="form-shippings-hidden">');
		hiddenForm.attr('action', '{{delete}}'.replace(/&amp;/g, '&'));
                hiddenForm.append($('#form-payments :input[name*=\'selected\']:checked').clone());
                $(document.body).append(hiddenForm);
                hiddenForm.submit();
            }
        });
        $('#button-copy').on('click', function () {
            var hiddenForm = $('<form  method="post" enctype="multipart/form-data" id="form-shippings-hidden">');
            hiddenForm.attr('action', '{{ clone }}'.replace(/&amp;/g, '&'));
            hiddenForm.append($('#form-payments :input[name*=\'selected\']:checked').clone());
            $(document.body).append(hiddenForm);
            hiddenForm.submit();
        });
    });
</script>

{{ footer }}