{{ header }}
{{ column_left }}
<div id="content">
	<div class="page-header">
        <div class="container-fluid">
			<div class="pull-right">
                <button type="submit" form="form" class="btn btn-primary save-changes" data-toggle="tooltip" data-original-title="Save Changes"><i class="fa fa-check"></i></button>
                {% if module_id is defined and module_id is not empty %}
                    <button type="button" class="btn btn-default btn-duplicate" data-toggle="tooltip" data-original-title="Duplicate" data-target="#duplicateModal"><i class="fa fa-copy"></i></button>
                {% endif %}
                <a onclick="location = '{{ cancel }}'" class="btn btn-danger" data-toggle="tooltip" data-original-title="Cancel"><i class="fa fa-times"></i></a>
            </div>
          <h1>{{ moduleTitle }}</h1>
          <ul class="breadcrumb">
            {% for breadcrumb in breadcrumbs %}
            <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
            {% endfor %}
          </ul>
        </div>
  	</div>

    <div class="container-fluid">
    	{{ b64  }}
         {% if (error_warning) %}
            <div class="alert alert-danger autoSlideUp"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
             <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
            <script>$('.autoSlideUp').delay(3000).fadeOut(600, function(){ $(this).show().css({'visibility':'hidden'}); }).slideUp(600);</script>
        {% endif %}
        {% if (success) %}
            <div class="alert alert-success autoSlideUp"><i class="fa fa-check-circle"></i> {{ success }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
            <script>$('.autoSlideUp').delay(3000).fadeOut(600, function(){ $(this).show().css({'visibility':'hidden'}); }).slideUp(600);</script>
        {% endif %}

        <div class="panel panel-default">
        	<div class="panel-heading">
                <div class="storeSwitcherWidget">
                </div>
                <h3 class="panel-title"><i class="fa fa-list"></i>&nbsp;<span style="vertical-align:middle;font-weight:bold;">Module settings</span></h3>
            </div>

            <div class="panel-body">
                <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form">
                    <input type="hidden" name="store_id" value="{{ store.store_id }}" />
                    <div class="tabbable">
                        <div class="tab-navigation form-inline">
                            <ul class="nav nav-tabs mainMenuTabs" id="mainTabs">
                                <li><a href="#google_settings" data-toggle="tab">{{ (module_id is not empty) ? googlelogin.name : 'Google' }} Settings</a></li>
                                <li><a href="#isense-support" role="tab" data-toggle="tab"><i class="fa fa-external-link"></i>&nbsp;Support</a></li>
    						</ul>
                        </div><!-- /.tab-navigation -->
                        <div class="tab-content">
                            <div id="google_settings" class="tab-pane fade">{{ tabs.google_settings }}</div>
                            <div id="isense-support" class="tab-pane">{{ tabs.support }}</div>
                        </div> <!-- /.tab-content -->
                    </div><!-- /.tabbable -->
                    <input type="hidden" name="googlelogin_license[Activated]" value="Yes" />
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
	$('#mainTabs a:first').tab('show'); // Select first tab
	if (window.localStorage && window.localStorage['currentTab']) {
		$('.mainMenuTabs a[href="'+window.localStorage['currentTab']+'"]').tab('show');
	}
	if (window.localStorage && window.localStorage['currentSubTab']) {
		$('a[href="'+window.localStorage['currentSubTab']+'"]').tab('show');
	}
	$('.fadeInOnLoad').css('visibility','visible');
	$('.mainMenuTabs a[data-toggle="tab"]').click(function() {
		if (window.localStorage) {
			window.localStorage['currentTab'] = $(this).attr('href');
		}
	});
	$('a[data-toggle="tab"]:not(.mainMenuTabs a[data-toggle="tab"], .review_tabs a[data-toggle="tab"])').click(function() {
		if (window.localStorage) {
			window.localStorage['currentSubTab'] = $(this).attr('href');
		}
	});

    $('.btn-duplicate').on('click', function() {
        var newName = prompt("Enter a new name");

        if(newName) {
            $.ajax({
            url: '{{ url_duplicate_module }}',
            type: 'GET',
            data: {module_id : '{{ (module_id is not empty) ? module_id : '' }}', name : newName},
            dataType: 'json',
            success: function (response) {
                console.log(response);
                if(response == 'This module name already exists!') {
                    alert(response);
                }
                else {
                    window.location = response;
                }
            }
            });
        } else if(newName == '') {
            alert("The name cannot be empty!");
        }
    });
</script>

{{ footer }}
