{{ header }}{{ column_left }}

<div id="content">

    <div class="page-header">
        <div class="container-fluid">
            <div class="pull-right">
                {% if license_error == null %}
                    <button type="submit" name="action" value="save" form="form" data-toggle="tooltip"
                            title="{{ button_save }}" class="btn btn-primary"><i
                                class="fa fa-save"></i> {{ button_save }}</button>
                    <button type="submit" name="action" value="save_and_close" form="form" data-toggle="tooltip"
                            title="{{ button_save_and_close }}" class="btn btn-default"><i
                                class="fa fa-save"></i> {{ button_save_and_close }}</button>
                {% else %}
                    <a href="{{ recheck }}" data-toggle="tooltip" title="{{ button_recheck }}" class="btn btn-primary"/>
                    <i class="fa fa-check"></i> {{ button_recheck }}</a>
                {% endif %}
                <a href="{{ close }}" data-toggle="tooltip" title="{{ button_close }}" class="btn btn-default"><i
                            class="fa fa-close"></i> {{ button_close }}</a>
            </div>
            <img width="36" height="36" style="float:left" src="view/image/neoseo.png" alt=""/>
            <h1>{{ heading_title_raw }} {{ text_module_version }}</h1>
            <ul class="breadcrumb">
                {% for breadcrumb in breadcrumbs %}
                    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="container-fluid">
        {% if error_warning %}
            <div class="alert alert-danger">
                <i class="fa fa-exclamation-circle"></i> {{ error_warning }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        {% if success is defined and success %}
            <div class="alert alert-success">
                <i class="fa fa-check-circle"></i>
                {{ success }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        <div class="content">

            <div class="ui-helper-clearfix" style="height: 55px">
                <div class="pull-right">
                    {{ widgets.storesDropdown( stores ) }}
                </div>
            </div>

            {{ text_description }}
            <button onclick="generate();" title="{{ button_ganerate }}" class="btn btn-primary pull-right"
                    style="margin-bottom: 10px"><i class="fa fa-spinner"></i> {{ button_ganerate }}</button>
            <form action="{{ save }}" method="post" enctype="multipart/form-data" id="form" class="row">
                {{ widgets.textareaWideMultiStore(stores, 'content', 6, 'width: 100%; height: 300px; padding: 5px; border: 1px solid #CCCCCC; background: #FFFFFF; overflow: scroll') }}
            </form>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('a.save').click(function () {
            if (!confirm("{{ text_confirm_save }}")) {
                return false;
            }
        });
    });

    function generate() {
        var stores = [{{ js_stores|join(',') }}];

        $.ajax({
            url: 'index.php?route=tool/neoseo_robots_generator/generate&user_token={{ user_token }}',
            type: 'post',
            dataType: 'json',
            data: '',
            success: function (json) {
                $('.alert').remove();
                if (json['error']) {
                    $('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
                }

                if (json['content'] && json['success']) {
                    $('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-exclamation-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');

                    stores.forEach(function (item) {
                        console.log(item);
                        $('[id="content[' + item + ']"]').val(json['content']);
                    });

                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    }
</script>
{{ footer }}