{{ header }}{{ column_left }}
<div id="content">
    <div class="page-header">
        <div class="container-fluid">
            <div class="pull-right">
                <a href="{{ refresh }}" data-toggle="tooltip" title="{{ button_refresh }}" class="btn btn-default"><i
                        class="fa fa-refresh"></i></a>
                <a href="{{ add }}" data-toggle="tooltip" title="{{ button_add }}" class="btn btn-primary"><i
                        class="fa fa-plus"></i></a>
                <button type="button" data-toggle="tooltip" title="{{ button_delete }}" class="btn btn-danger"
                        onclick="confirm('{{ text_confirm }}') ? $('#form-city').submit() : false;"><i
                        class="fa fa-trash-o"></i></button>
            </div>
            <img width="36" height="36" style="float:left;margin-right: 10px;" src="view/image/neoseo.png" alt="">
            <h1>{{ heading_title }}</h1>
            <ul class="breadcrumb">
                {% for breadcrumb in breadcrumbs %}
                    <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="container-fluid">
        {% if (error_warning) %}
            <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        {% if (success) %}
            <div class="alert alert-success"><i class="fa fa-check-circle"></i> {{ success }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-list"></i> {{ text_list }}</h3>
            </div>

            <div class="panel-body">
                <div class="well">
                    <div class="row">
                        <div class="col-sm-12 col-md-4">
                            <div class="form-group">
                                <label class="control-label" for="input-status">{{ column_country }}</label>
                                <select name="filter_country" id="input-country" class="form-control">
                                    <option value="*"></option>
                                    {% for country in countries %}
                                        {# if ($country['city_count'] >= 1) { #}
                                        {% if (country['country_id'] == filter_country) %}
                                            <option value="{{ country['country_id'] }}"
                                                    selected="selected">{{ country['name'] }}</option>
                                        {% else %}
                                            <option value="{{ country['country_id'] }}">
                                                &nbsp;&nbsp;{{ country['name'] }}</option>
                                        {% endif %}
                                        {# } #}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-4">
                            <div class="form-group">
                                <label class="control-label" for="input-status">{{ column_zone }}</label>
                                <select name="filter_zone" id="input-zone" class="form-control">
                                    <option value="*"></option>
                                    {% for zone in zones %}
                                        {# if ($zone['city_count'] >= 1) { #}
                                        {% if (zone['zone_id'] == filter_zone) %}
                                            <option value="{{ zone['zone_id'] }}" selected="selected">{{ zone['name'] }}
                                                &nbsp;&nbsp;&nbsp;&nbsp;
                                            </option>
                                        {% else %}
                                            <option value="{{ zone['zone_id'] }}">&nbsp;&nbsp;{{ zone['name'] }}&nbsp;&nbsp;&nbsp;&nbsp;</option>
                                        {% endif %}
                                        {# } #}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-4">
                            <div class="form-group">
                                <label class="control-label" for="input-name">{{ column_name }}</label>
                                <input type="text" name="filter_name" value="{{ filter_name }}"
                                       placeholder="{{ entry_name }}" id="input-name" class="form-control"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 text-right">
                            <button type="button" id="button-filter" class="btn btn-primary pull-right"><i
                                    class="fa fa-search"></i> {{ button_filter }}</button>
                        </div>
                    </div>
                </div>

                <form action="{{ delete }}" method="post" enctype="multipart/form-data" id="form-city">
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead>
                            <tr>
                                <td style="width: 1px;" class="text-center"><input type="checkbox"
                                                                                   onclick="$('input[name*=\'selected\']').prop('checked', this.checked);"/>
                                </td>
                                <td class="text-left">{% if (sort == 'c.name') %}
                                        <a href="{{ sort_country }}" class="{{ order|lower }}">{{ column_country }}</a>
                                    {% else %}
                                        <a href="{{ sort_country }}">{{ column_country }}</a>
                                    {% endif %}</td>
                                <td class="text-left">{% if (sort == 'z.name') %}
                                        <a href="{{ sort_zone }}" class="{{ order|lower }}">{{ column_zone }}</a>
                                    {% else %}
                                        <a href="{{ sort_zone }}">{{ column_zone }}</a>
                                    {% endif %}</td>
                                <td class="text-left">{% if (sort == 'cd.name') %}
                                        <a href="{{ sort_name }}" class="{{ order|lower }}">{{ column_name }}</a>
                                    {% else %}
                                        <a href="{{ sort_name }}">{{ column_name }}</a>
                                    {% endif %}</td>

                                <td class="text-right">{{ column_action }}</td>
                            </tr>
                            </thead>
                            <tbody>
                            {% if (cities) %}
                                {% for city in cities %}
                                    <tr>
                                        <td class="text-center">{% if selected in city['city_id'] %}
                                                <input type="checkbox" name="selected[]" value="{{ city['city_id'] }}"
                                                       checked="checked"/>
                                            {% else %}
                                                <input type="checkbox" name="selected[]" value="{{ city['city_id'] }}"/>
                                            {% endif %}</td>
                                        <td class="text-left">{{ city['country'] }}</td>
                                        <td class="text-left">{{ city['zone'] }}</td>
                                        <td class="text-left">{{ city['name'] }}</td>
                                        <!-- todo: Добавить на кнопку удаления подтверждение -->
                                        <td class="text-right"><a href="{{ city['edit'] }}" data-toggle="tooltip"
                                                                  title="{{ button_edit }}" class="btn btn-primary"><i
                                                    class="fa fa-pencil"></i></a> <a href="{{ city['delete'] }}"
                                                                                     data-toggle="tooltip"
                                                                                     title="{{ button_delete }}"
                                                                                     class="btn btn-danger"><i
                                                    class="fa fa-trash-o"></i></a></td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td class="text-center" colspan="5">{{ text_no_results }}</td>
                                </tr>
                            {% endif %}
                            </tbody>
                        </table>
                    </div>
                </form>
                <div class="row">
                    <div class="col-sm-6 text-left">{{ pagination }}</div>
                    <div class="col-sm-6 text-right">{{ results }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $('#input-country').on('change', function () {
        var country_id = $('#input-country').val();
        console.log(country_id);
        $.ajax({
            url: 'index.php?route=localisation/neoseo_city/reloadzones&user_token=' + getURLVar('user_token'),
            type: 'post',
            data: 'country_id=' + country_id + '&fromlist=1'{% if (filter_zone) %} + '&zone_id=' +{{ filter_zone }} {% endif %},
            dataType: 'html',
            success: function (html) {
                var zonelist = '<option value="*"></option>' + html;
                $('#input-zone').html(zonelist);
                console.log('changed');
            }
        });
    });

    $('#button-filter').on('click', function () {
        var url = 'index.php?route=localisation/neoseo_city&user_token={{ user_token }}';

        var filter_name = $('input[name=\'filter_name\']').val();

        if (filter_name) {
            url += '&filter_name=' + encodeURIComponent(filter_name);
        }

        var filter_country = $('select[name=\'filter_country\']').val();

        if (filter_country != '*') {
            url += '&filter_country=' + encodeURIComponent(filter_country);
        }

        var filter_zone = $('select[name=\'filter_zone\']').val();

        if (filter_zone != '*') {
            url += '&filter_zone=' + encodeURIComponent(filter_zone);
        }
        location = url;
    });
</script>
{{ footer }}