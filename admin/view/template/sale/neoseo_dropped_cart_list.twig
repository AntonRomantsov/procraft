{{ header }}{{ column_left }}
<div id="content">
    <div class="page-header">
        <div class="container-fluid">
            <div class="pull-right">
                <button type="button" data-toggle="tooltip" title="{{ button_notify }}" class="btn btn-success" data-url="{{ notify_url }}" data-ajax="false"><i class="fa fa-envelope-o"></i></button>
                <button type="button" data-toggle="tooltip" title="{{ button_delete }}" class="btn btn-danger" data-confirm="{{ text_confirm }}" data-url="{{ delete_url }}"><i class="fa fa-trash-o"></i></button>
            </div>
            <img width="36" height="36" style="float:left" src="view/image/neoseo.png" alt=""/>
            <h1>{{ heading_title }}</h1>
            <ul class="breadcrumb">
                {% for breadcrumb in breadcrumbs %}
                    <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="container-fluid">
        {% if error_warning %}
            <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        {% if success %}
            <div class="alert alert-success"><i class="fa fa-check-circle"></i> {{ success }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="well">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label" for="input-email">{{ entry_email }}</label>
                                <input type="text" name="filter_email" value="{{ filter_email }}"
                                       placeholder="{{ entry_email }}" id="input-email"
                                       class="form-control"/>
                            </div>
                        </div>

                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label" for="input-name">{{ entry_name }}</label>
                                <input type="text" name="filter_name" value="{{ filter_name }}"
                                       placeholder="{{ entry_name }}" id="input-name"
                                       class="form-control"/>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label"
                                       for="input-modified">{{ entry_modified }}</label>
                                <div class="input-group date">
                                    <input type="text" name="filter_modified"
                                           value="{{ filter_modified }}"
                                           placeholder="{{ entry_modified }}" data-date-format="YYYY-MM-DD"
                                           id="input-modified" class="form-control"/>
                                    <span class="input-group-btn">
                                        <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                                    </span>
                                </div>
                            </div>
                            <button type="button" id="button-filter" class="btn btn-primary pull-right"><i
                                        class="fa fa-search"></i> {{ button_filter }}</button>
                        </div>
                    </div>
                </div>

                <form action="{{ delete_url }}" method="post" enctype="multipart/form-data" id="form-cart">
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead>
                            <tr>
                                <td style="width: 1px;" class="text-center"><input type="checkbox"
                                                                                   onclick="$('input[name*=\'selected\']').prop('checked', this.checked);"/>
                                </td>
                                <td class="text-left">
                                    <a href="{{ sort_email }}" class="{{ sort == 'email' ? order|lower : '' }}">{{ column_email }}</a>
                                </td>
                                <td class="text-left">
                                    <a href="{{ sort_name }}" class="{{ sort == 'name' ? order|lower : '' }}">{{ column_name }}</a>
                                </td>
                                <td class="text-left">
                                    <a href="{{ sort_phone }}" class="{{ sort == 'phone' ? order|lower : '' }}">{{ column_phone }}</a>
                                </td>
                                <td class="text-left">
                                    <a href="{{ sort_notification_count }}" class="{{ sort == 'notification_count' ? order|lower : '' }}">{{ column_notification_count }}</a>
                                </td>
                                <td class="text-left">
                                    <a href="{{ sort_modified }}" class="{{ sort == 'modified' ? order|lower : '' }}">{{ column_modified }}</a>
                                </td>
                                <td class="text-left">
                                    <a href="{{ sort_total }}" class="{{ sort == 'total' ? order|lower : '' }}">{{ column_total }}</a>
                                </td>
                                <td class="text-right">{{ column_action }}</td>
                            </tr>
                            </thead>
                            <tbody>
                            {% if carts %}
                                {% for cart in carts %}
                                    <tr data-id="{{ cart['dropped_cart_id'] }}">
                                        <td class="text-center">{% if selected in cart.dropped_cart_id %}
                                                <input type="checkbox" name="selected[]" value="{{ cart['dropped_cart_id'] }}"
                                                       checked="checked"/>
                                            {% else %}
                                                <input type="checkbox" name="selected[]" value="{{ cart['dropped_cart_id'] }}"/>
                                            {% endif %}
                                        <td class="text-left">{{ cart['email'] }}</td>
                                        <td class="text-right">{{ cart['name'] }}</td>
                                        <td class="text-left">{{ cart['phone'] }}</td>
                                        <td class="text-left notification"><span class="label label-{{ cart['notification_count']>0?'success':'danger' }}">{{ cart['notification_count'] }}</span></td>
                                        <td class="text-left">{{ cart['modified'] }}</td>
                                        <td class="text-right">{{ cart['total'] }}</td>
                                        <td class="text-right">
                                            <a href="{{ cart['notify'] }}" data-toggle="tooltip" title="{{ button_notify }}" class="btn btn-info" data-type="notification">
                                                <i class="fa fa-envelope-o"></i>
                                            </a>
                                            <a href="{{ cart['view'] }}" data-toggle="tooltip" title="{{ button_view }}" class="btn btn-info">
                                                <i class="fa fa-eye"></i>
                                            </a>
                                            <a type="button" href="{{ cart['delete'] }}" onclick="return confirm('{{ text_confirm }}');" id="button-delete{{ cart['dropped_cart_id'] }}"
                                               data-loading-text="{{ text_loading }}" data-toggle="tooltip" title="{{ button_delete }}" class="btn btn-danger">
                                                <i class="fa fa-trash-o"></i>
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td class="text-center" colspan="8">{{ text_no_results }}</td>
                                </tr>
                            {% endif %}
                            </tbody>
                        </table>
                    </div>
                </form>
                <div class="row">
                    <div class="col-sm-6 text-left">{{ pagination }}</div>
                    <div class="col-sm-6 text-right">{{ results }}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<link href="view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css" type="text/css" rel="stylesheet" media="screen" />
<script type="text/javascript">
		$(document).ready(function (e) {
			$('#button-filter').on('click', function() {
				var url = 'index.php?route=sale/neoseo_dropped_cart&user_token={{ user_token }}';

				$('.panel-body .well input').each(function(e) {
					if($(this).val())
						url += '&'+$(this).attr('name')+'='+encodeURIComponent($(this).val());
				});

				location = url;
			});
			$('.date').datetimepicker({
				pickTime: false
			});
			$('.page-header .container-fluid button.btn').bind('click', function (e) {
				if(!$(this).data('confirm') || confirm($(this).data('confirm'))) {
					if((!$(this).data('ajax') || $(this).data('ajax')!=true) && $('#form-cart input[name="selected[]"]:checked')[0]) {
						$('#form-cart').attr('action', $(this).data('url')).submit();
					} else if($(this).data('ajax')) {

					}
				}
			});

			$('a[data-type=notification]').bind('click', function (e) {
				e.preventDefault();
				var el = $(this);
				el.prepend($('<i class="fa fa-refresh fa-spin fa-fw"></i> &nbsp;'));
				$.ajax({
					url: $(this).attr('href'),
					dataType:'json',
					success: function (data) {
						if(!$('.container-fluid .alert')[0]) $('.container-fluid .panel-body').parents('.container-fluid').prepend($('<div class="alert"></div>'));
						var container = $('.container-fluid .alert');
						container.empty();
						if(data.result == 'success') {
							container.attr('class', 'alert alert-success').append($('<i class="fa fa-check-circle"></i>'));
						} else {
							container.attr('class', 'alert alert-danger').append($('<i class="fa fa-exclamation-circle"></i>'));
						}
						var form = $('#form-cart');
						if(data.carts) {
							for(k in data.carts) {
								var span = form.find('table tr[data-id='+data.carts[k]['id']+'] td.notification span');
								span.empty().append(data.carts[k]['notified']);
								if(data.carts[k]['notified']>0) span.attr('class','label label-success');
								else span.attr('class','label label-danger');
							}
						}
						if(data.messages) {
							for(var k in data.messages) {
								container.append($(data.messages[k]+'<br />'))
							}
						}

                        if(typeof data[0] !== 'undefined' && typeof data[0].messages[0]){
                            container.append(' ' + data[0].messages[0]);
                        } else if(data.message) {
                            container.append(' ' + data.message);
                        }

						container.delay(4000).slideUp(200, function() {
							$(this).remove();
						});
						el.find('i.fa-refresh').remove();
					}
				});
			})
		});
</script>
{{ footer }}